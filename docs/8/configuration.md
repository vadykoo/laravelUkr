# Конфігурація

-   [Вступ](#introduction)
-   [Конфігурація середовища](#environment-configuration)
    -   [Типи змінних середовищ](#environment-variable-types)
    -   [Отримання конфігурації середовища](#retrieving-environment-configuration)
    -   [Визначення поточного середовища](#determining-the-current-environment)
    -   [Приховування змінних середовища на сторінках налагодження](#hiding-environment-variables-from-debug)
-   [Доступ до значень конфігурації](#accessing-configuration-values)
-   [Кешування конфігурації](#configuration-caching)
-   [Режим обслуговування](#maintenance-mode)

<a name="introduction"></a>

## Вступ

Усі файли конфігурації фреймворку Laravel зберігаються в`config`каталог. Кожен варіант задокументований, тож сміливо переглядайте файли та знайомтесь із доступними вам параметрами.

<a name="environment-configuration"></a>

## Конфігурація середовища

Часто корисно мати різні значення конфігурації залежно від середовища, в якому працює програма. Наприклад, ви можете використовувати інший драйвер кешу локально, ніж на виробничому сервері.

Щоб зробити це надзвичайним, Laravel використовує[DotEnv](https://github.com/vlucas/phpdotenv)Бібліотека PHP Ванса Лукаса. У новій інсталяції Laravel кореневий каталог вашої програми міститиме файл`.env.example`файл. Якщо ви встановите Laravel через Composer, цей файл буде автоматично скопійовано в`.env`. В іншому випадку слід скопіювати файл вручну.

Ваш`.env`файл не повинен бути призначений для керування джерелом програми, оскільки кожен розробник / сервер, що використовує вашу програму, може вимагати іншої конфігурації середовища. Крім того, це може становити ризик для безпеки у випадку, якщо зловмисник отримає доступ до вашого сховища керування джерелом, оскільки будь-які конфіденційні дані можуть бути розкриті.

Якщо ви розвиваєтеся з командою, ви можете продовжувати включати a`.env.example`файл із вашою заявкою. Помістивши значення заповнювачів у прикладний файл конфігурації, інші розробники у вашій команді можуть чітко бачити, які змінні середовища потрібні для запуску вашого додатка. Ви також можете створити файл`.env.testing`файл. Цей файл замінить файл`.env`файл під час запуску тестів PHPUnit або виконання команд Artisan за допомогою`--env=testing`варіант.

> {tip} Будь-яка змінна у вашому`.env`файл може бути замінений зовнішніми змінними середовища, такими як змінні середовища рівня сервера або рівня системи.

<a name="environment-variable-types"></a>

### Типи змінних середовищ

Всі змінні у вашому`.env`файли аналізуються як рядки, тому було створено деякі зарезервовані значення, що дозволяють повернути ширший діапазон типів із`env()`функція:

| `.env`Значення | `env()`Значення |
| -------------- | --------------- |
| правда         | (bool) правда   |
| (правда)       | (bool) правда   |
| помилковий     | (bool) хибний   |
| (помилковий)   | (bool) хибне    |
| порожній       | (рядок) ''      |
| (порожній)     | (рядок) ''      |
| нуль           | (нуль) нуль     |
| (нуль)         | (нуль) null     |

Якщо вам потрібно визначити змінну середовища зі значенням, яке містить пробіли, ви можете зробити це, заключивши значення у подвійні лапки.

    APP_NAME="My Application"

<a name="retrieving-environment-configuration"></a>

### Отримання конфігурації середовища

Всі змінні, перелічені в цьому файлі, будуть завантажені в`$_ENV`PHP супер глобальний, коли ваша програма отримує запит. Однак ви можете використовувати`env`помічник для отримання значень із цих змінних у файлах конфігурації. Насправді, переглянувши конфігураційні файли Laravel, ви помітите кілька варіантів, які вже використовують цей помічник:

    'debug' => env('APP_DEBUG', false),

Друге значення передається в`env`function є "значенням за замовчуванням". Це значення буде використано, якщо для даного ключа не існує змінної середовища.

<a name="determining-the-current-environment"></a>

### Визначення поточного середовища

Поточне середовище програми визначається за допомогою`APP_ENV`змінна від вашого`.env`файл. Ви можете отримати доступ до цього значення через`environment`метод на`App`[фасад](/docs/{{version}}/facades):

    $environment = App::environment();

Ви також можете передати аргументи до`environment`метод, щоб перевірити, чи відповідає середовище заданому значенню. Метод повернеться`true`якщо оточення відповідає будь-якому із заданих значень:

    if (App::environment('local')) {
        // The environment is local
    }

    if (App::environment(['local', 'staging'])) {
        // The environment is either local OR staging...
    }

> {tip} Поточне виявлення середовища програми може бути замінене на рівні сервера`APP_ENV`змінна середовища. Це може бути корисно, коли вам потрібно спільно використовувати один і той же додаток для різних конфігурацій середовища, тому ви можете налаштувати певний хост так, щоб він відповідав даному середовищу у конфігураціях вашого сервера.

<a name="hiding-environment-variables-from-debug"></a>

### Приховування змінних середовища на сторінках налагодження

Коли виняток не вловлюється і`APP_DEBUG`змінною середовища є`true`, на сторінці налагодження буде показано всі змінні середовища та їх вміст. У деяких випадках вам може знадобитися затемнити певні змінні. Ви можете зробити це, оновивши`debug_hide`варіант у вашому`config/app.php`файл конфігурації.

Деякі змінні доступні як у змінних середовища, так і в даних сервера / запиту. Тому вам може знадобитися приховати їх для обох`$_ENV`і`$_SERVER`:

    return [

        // ...

        'debug_hide' => [
            '_ENV' => [
                'APP_KEY',
                'DB_PASSWORD',
            ],

            '_SERVER' => [
                'APP_KEY',
                'DB_PASSWORD',
            ],

            '_POST' => [
                'password',
            ],
        ],
    ];

<a name="accessing-configuration-values"></a>

## Доступ до значень конфігурації

Ви можете легко отримати доступ до значень конфігурації, використовуючи глобальний`config`допоміжну функцію з будь-якої точки вашої програми. Значення конфігурації можна отримати за допомогою синтаксису "крапка", який включає ім'я файлу та опцію, до якої ви хочете отримати доступ. Також може бути вказано значення за замовчуванням, яке буде повернуто, якщо параметр конфігурації не існує:

    $value = config('app.timezone');

    // Retrieve a default value if the configuration value does not exist...
    $value = config('app.timezone', 'Asia/Seoul');

Щоб встановити значення конфігурації під час виконання, передайте масив до`config`помічник:

    config(['app.timezone' => 'America/Chicago']);

<a name="configuration-caching"></a>

## Кешування конфігурації

Щоб надати додатку прискорення, слід кешувати всі файли конфігурації в один файл за допомогою`config:cache`Ремісниче командування. Це об’єднає всі параметри конфігурації для вашого додатку в один файл, який буде швидко завантажений фреймворком.

Зазвичай слід запускати`php artisan config:cache`команда як частина вашої процедури розгортання виробництва. Команда не повинна запускатися під час локальної розробки, оскільки параметри конфігурації часто потрібно змінювати під час розробки вашої програми.

> {note} Якщо ви виконаєте файл`config:cache`команди під час процесу розгортання, ви повинні бути впевнені, що телефонуєте лише на`env`функція з файлів конфігурації. Після кешування конфігурації файл`.env`файл не буде завантажений, і всі дзвінки до`env`функція повернеться`null`.

<a name="maintenance-mode"></a>

## Режим обслуговування

Коли ваша програма перебуває в режимі обслуговування, для всіх запитів до вашої програми відображатиметься спеціальний вигляд. Це полегшує "вимкнення" програми під час її оновлення або під час технічного обслуговування. Перевірка режиму обслуговування входить у стандартний стек проміжного програмного забезпечення для вашої програми. Якщо програма перебуває в режимі обслуговування, a`MaintenanceModeException`буде видано з кодом стану 503.

Щоб увімкнути режим обслуговування, запустіть`down`Команда ремісників:

    php artisan down

Ви також можете надати a`retry`варіант для`down`команда, яка буде встановлена ​​як`Retry-After`Значення заголовка HTTP&#x3A;

    php artisan down --retry=60

<a name="bypassing-maintenance-mode"></a>

#### В обхід режиму обслуговування

Навіть перебуваючи в режимі обслуговування, ви можете використовувати`secret`можливість вказати маркер обходу режиму обслуговування:

    php artisan down --secret="1630542a-246b-4b66-afa1-dd72a4c43515"

Після розміщення програми в режимі обслуговування ви можете перейти до URL-адреси програми, що відповідає цьому маркеру, і Laravel видасть браузеру обхідний файл cookie режиму обслуговування:

    https://example.com/1630542a-246b-4b66-afa1-dd72a4c43515

Коли ви отримуєте доступ до цього прихованого маршруту, ви будете перенаправлені на`/`маршрут програми. Після видачі файлу cookie у ваш браузер ви зможете нормально переглядати програму, ніби вона не перебуває в режимі обслуговування.

<a name="pre-rendering-the-maintenance-mode-view"></a>

#### Попереднє відтворення подання режиму обслуговування

Якщо ви використовуєте`php artisan down`під час розгортання, користувачі все одно можуть іноді стикатися з помилками, якщо отримують доступ до програми під час оновлення залежностей Composer або інших компонентів інфраструктури. Це відбувається тому, що значна частина фреймворку Laravel повинна завантажитися, щоб визначити, чи ваш додаток перебуває в режимі технічного обслуговування, і зробити представлення режиму обслуговування за допомогою механізму шаблонування.

З цієї причини Laravel дозволяє попередньо відтворити подання режиму обслуговування, яке буде повернуто на самому початку циклу запиту. Цей подання відображається до завантаження залежностей вашої програми. Ви можете попередньо відтворити обраний вами шаблон за допомогою`down`команди`render`варіант:

    php artisan down --render="errors::503"

<a name="redirecting-maintenance-mode-requests"></a>

#### Перенаправлення запитів на режим обслуговування

Перебуваючи в режимі обслуговування, Laravel відображатиме режим режиму обслуговування для всіх URL-адрес програм, до яких користувач намагається отримати доступ. Якщо ви бажаєте, ви можете доручити Laravel перенаправити всі запити на певну URL-адресу. Це може бути здійснено за допомогою`redirect`варіант. Наприклад, ви можете перенаправити всі запити на`/`Ненависть:

    php artisan down --redirect=/

<a name="disabling-maintenance-mode"></a>

#### Вимкнення режиму обслуговування

Щоб вимкнути режим обслуговування, використовуйте`up`команда:

    php artisan up

> {tip} Ви можете налаштувати шаблон режиму обслуговування за замовчуванням, визначивши свій власний шаблон на`resources/views/errors/503.blade.php`.

<a name="maintenance-mode-queues"></a>

#### Режим обслуговування та черги

Поки ваша програма перебуває в режимі обслуговування, ні[робочі місця в черзі](/docs/{{version}}/queues)буде оброблено. Після того, як програма вийде з режиму обслуговування, із завданнями працюватимуть у звичайному режимі.

<a name="alternatives-to-maintenance-mode"></a>

#### Альтернативи режиму обслуговування

Оскільки режим технічного обслуговування вимагає від вашої програми декількох секунд простою, розгляньте такі альтернативи, як[Надіслати](https://envoyer.io)для розгортання нульових простоїв за допомогою Laravel.
